<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>用户端（前端/客户端） | Skim Book</title>
    <meta name="description" content="Just playing around">
    <meta name="generator" content="VuePress 1.3.1">
    
    
    <link rel="preload" href="/SkimBook/assets/css/0.styles.31313faf.css" as="style"><link rel="preload" href="/SkimBook/assets/js/app.39a981f5.js" as="script"><link rel="preload" href="/SkimBook/assets/js/2.67bc7483.js" as="script"><link rel="preload" href="/SkimBook/assets/js/14.ab42a9fe.js" as="script"><link rel="prefetch" href="/SkimBook/assets/js/10.e3477a0d.js"><link rel="prefetch" href="/SkimBook/assets/js/11.31f62871.js"><link rel="prefetch" href="/SkimBook/assets/js/12.88564199.js"><link rel="prefetch" href="/SkimBook/assets/js/13.48188c55.js"><link rel="prefetch" href="/SkimBook/assets/js/15.510924d0.js"><link rel="prefetch" href="/SkimBook/assets/js/16.87da21a6.js"><link rel="prefetch" href="/SkimBook/assets/js/17.73b12ce0.js"><link rel="prefetch" href="/SkimBook/assets/js/18.2c548e3a.js"><link rel="prefetch" href="/SkimBook/assets/js/19.bf269089.js"><link rel="prefetch" href="/SkimBook/assets/js/20.77946372.js"><link rel="prefetch" href="/SkimBook/assets/js/21.1cc1b4af.js"><link rel="prefetch" href="/SkimBook/assets/js/3.b92b6370.js"><link rel="prefetch" href="/SkimBook/assets/js/4.f03b7f8e.js"><link rel="prefetch" href="/SkimBook/assets/js/5.a130259b.js"><link rel="prefetch" href="/SkimBook/assets/js/6.81d5c476.js"><link rel="prefetch" href="/SkimBook/assets/js/7.f131726d.js"><link rel="prefetch" href="/SkimBook/assets/js/8.2a3eb77d.js"><link rel="prefetch" href="/SkimBook/assets/js/9.9b0050ff.js">
    <link rel="stylesheet" href="/SkimBook/assets/css/0.styles.31313faf.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/SkimBook/" class="home-link router-link-active"><!----> <span class="site-name">Skim Book</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/SkimBook/" class="nav-link">
  Home
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/SkimBook/" class="nav-link">
  Home
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/SkimBook/" class="sidebar-link">首页</a></li><li><a href="/SkimBook/design.html" class="sidebar-link">设计</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/SkimBook/userend/" class="sidebar-heading clickable router-link-exact-active router-link-active active"><span>用户端（前端/客户端）</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/SkimBook/nodeend/" class="sidebar-heading clickable"><span>节点端</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/SkimBook/deploy.html" class="sidebar-link">部署</a></li><li><a href="/SkimBook/reference.html" class="sidebar-link">开源引用（后端）</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="用户端（前端-客户端）"><a href="#用户端（前端-客户端）" class="header-anchor">#</a> 用户端（前端/客户端）</h1> <h2 id="demo"><a href="#demo" class="header-anchor">#</a> Demo</h2> <p>测试后端地址：<a href="https://backend.skimproj.com/public/notice-column" target="_blank" rel="noopener noreferrer">https://backend.skimproj.com<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>测试示例：<a href="https://backend.skimproj.com/public/notice-column" target="_blank" rel="noopener noreferrer">https://backend.skimproj.com/public/notice-column<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="通用返回结果"><a href="#通用返回结果" class="header-anchor">#</a> 通用返回结果</h2> <p>大部分POST返回结果默认为：</p> <div class="language- extra-class"><pre class="language-text"><code>{
    &quot;Result&quot;:1/2/3,
    //1：成功
    //2：失败
    //3：异常
    &quot;Message&quot;:&quot;500&quot;,    //待定
    &quot;Jwt&quot;:&quot;...&quot;
    //有时jwt证书临近过期，此时任意POST会触发更新jwt，返回结果会附上新的jwt
    //因为jwt中保存了language信息，如果用户切换language，POST结果也会收到jwt
}
</code></pre></div><p>GET/POST返回的<code>Result</code>还有可能是<code>logout</code>，表示需要重新登录。</p> <p>例如，用户修改密码导致旧的jwt被拉黑。</p> <h2 id="列表查询"><a href="#列表查询" class="header-anchor">#</a> 列表查询</h2> <blockquote><p>后端提供了大量的列表查询API，格式统一：</p></blockquote> <h3 id="get-xxx-columns"><a href="#get-xxx-columns" class="header-anchor">#</a> GET /xxx-columns</h3> <blockquote><p>查询【列表的所有column（列名）】</p></blockquote> <p>请求参数：</p> <div class="language- extra-class"><pre class="language-text"><code>language=zh-Hans（/public下需要此参数，/user下不需要）
</code></pre></div><p>返回：</p> <div class="language- extra-class"><pre class="language-text"><code>{
    &quot;Result&quot;:1,
    &quot;Total&quot;:122,    //数据总数
    &quot;Columns&quot;:[
        {
            &quot;Name&quot;:&quot;menu&quot;,    //列名
            &quot;Text&quot;:&quot;菜单&quot;    //用于显示至前端，根据language的不同而显示不同的文字
            &quot;Reference&quot;:&quot;false&quot;/&quot;true&quot;,    //后续部分会解释
            
            &quot;Filters&quot;:[    //适用于该列的筛选
                {
                    &quot;Value&quot;:&quot;admin&quot;,
                    &quot;Text&quot;:&quot;管理员&quot;
                },
                {
                    &quot;Value&quot;:&quot;affman&quot;,
                    &quot;Text&quot;:&quot;affman&quot;
                }
            ]
        }
    ]
}
</code></pre></div><h3 id="get-xxx-list"><a href="#get-xxx-list" class="header-anchor">#</a> GET /xxx-list</h3> <blockquote><p>对列表进行分页查询</p></blockquote> <p>请求参数：</p> <div class="language- extra-class"><pre class="language-text"><code>筛选：（不写时，视为查找所有type）
filter[scenario]=1*2&amp;&amp;filter[type]=1
//scenario列筛选1和2，type列筛选1

语言：（/public下需要此参数，/user下不需要）
language=1

时区：（/public下需要此参数，/user下不需要）
timezone=480
//北京时区+8，则为8*60=480

按哪列排序：（不写时，使用默认排序）
sort=password&amp;asc=true
//按password升续排列

每页容量：
number=10

页码：
page=1

查找：
search=hello

是否查询完整内容：
full=true（false时仅返回hash id数组，true时返回完整内容）
</code></pre></div><p>返回：</p> <div class="language- extra-class"><pre class="language-text"><code>full=false时返回：{
    &quot;Result&quot;:1,
    &quot;Total&quot;:122,    //数据总数
    &quot;Items&quot;:[3a28ja,sadr22,3af34,4r33]    //hash id数组
}

full=true时返回：{
    &quot;Result&quot;:1,
    &quot;Total&quot;:122,    //数据总数
    &quot;Items&quot;:[    //根据column返回一个list内容的二维数组
        [
            ...
        ]
    ]
}
</code></pre></div><h3 id="get-xxx-pick"><a href="#get-xxx-pick" class="header-anchor">#</a> GET /xxx-pick</h3> <blockquote><p>查询指定hash id</p></blockquote> <p>请求参数：</p> <div class="language- extra-class"><pre class="language-text"><code>hash-id=...（可以同时查询多个id）

时区：（/public下需要此参数，/user下不需要）
timezone=480
//北京时区+8，则为8*60=480

</code></pre></div><p>返回结果：</p> <div class="language- extra-class"><pre class="language-text"><code>结构与分页查询/xxx-list的full=true返回结构相同
</code></pre></div><h3 id="reference用法"><a href="#reference用法" class="header-anchor">#</a> reference用法</h3> <p>/xxx-columns中提及到，column有一个reference属性，值为false/true</p> <p>值为false时，说明list返回的就是很直白的数据</p> <p>比如/node-list返回以下数据：</p> <div class="language- extra-class"><pre class="language-text"><code>&quot;Items&quot;:[
    {
        &quot;Name&quot;:&quot;中国A&quot;,    //节点名，reference:false
        &quot;Online&quot;:2    //在线人数，reference:false
    }
]
</code></pre></div><p>对应生成的列表就是：</p> <table><thead><tr><th style="text-align:left;">节点名</th> <th style="text-align:left;">在线人数</th></tr></thead> <tbody><tr><td style="text-align:left;">中国A</td> <td style="text-align:left;">2</td></tr></tbody></table> <p>当值为true时，说明这个column涉及另一张表</p> <p>比如/order-columns返回以下数据：</p> <div class="language- extra-class"><pre class="language-text"><code>&quot;Total&quot;:123,    //数据总数
&quot;Columns&quot;:[
    {
        &quot;Name&quot;:&quot;time&quot;
        &quot;Text&quot;:&quot;订单时间&quot;,
        &quot;Reference&quot;:&quot;false&quot;    //这里为false，则什么都不用管
    },
    {
        &quot;Name&quot;:&quot;menu&quot;
        &quot;Text&quot;:&quot;菜单&quot;,
        &quot;Reference&quot;:&quot;true&quot;    //这里为true，说明一定存在/menu列表查询和精确查询
    }    
]
</code></pre></div><p>reference为true的column，返回的内容是一个hash id</p> <p>接着上面的例子，/order-list返回以下数据：</p> <div class="language- extra-class"><pre class="language-text"><code>&quot;Items&quot;:[
    [
        &quot;2019-01-01 01:00:00&quot;,    //name，reference:false
        &quot;54f7gh&quot;,    //menu，reference:true，这里返回的是一个menu的id
                     //id不是数字，而是字符串（hash id）
    ],
    [
        &quot;2019-01-02 02:00:00&quot;,
        &quot;74ngx&quot;,
    ]
]
</code></pre></div><p>reference的显示方法相当自由，可以显示一串字符串：</p> <p>（因为reference为true，所以一定存在/menu列表查询和精确查询）</p> <table><thead><tr><th style="text-align:left;">订单时间</th> <th style="text-align:left;">菜单</th></tr></thead> <tbody><tr><td style="text-align:left;">2019-01-01 01:00:00</td> <td style="text-align:left;">租金：1元 限速：10M 流量价格：1元/G</td></tr> <tr><td style="text-align:left;">2019-01-02 02:00:00</td> <td style="text-align:left;">租金：2元 限速：20M 流量价格：2元/G</td></tr></tbody></table> <p>一个超链接：</p> <table><thead><tr><th style="text-align:left;">订单时间</th> <th style="text-align:left;">菜单</th></tr></thead> <tbody><tr><td style="text-align:left;">2019-01-01 01:00:00</td> <td style="text-align:left;">[菜单1](http://aaa.com/user/menu/1)</td></tr> <tr><td style="text-align:left;">2019-01-02 02:00:00</td> <td style="text-align:left;">[菜单2](http://aaa.com/user/menu/2)</td></tr></tbody></table> <p>或者直接什么都不做，直接把hash id放上去：</p> <table><thead><tr><th style="text-align:left;">订单时间</th> <th style="text-align:left;">菜单</th></tr></thead> <tbody><tr><td style="text-align:left;">2019-01-01 01:00:00</td> <td style="text-align:left;">54f7gh</td></tr> <tr><td style="text-align:left;">2019-01-02 02:00:00</td> <td style="text-align:left;">74ngx</td></tr></tbody></table> <h3 id="get-xxx-edit"><a href="#get-xxx-edit" class="header-anchor">#</a> GET /xxx-edit</h3> <blockquote><p>获取xxx的[编辑/新建]页面</p></blockquote> <p>请求参数：</p> <div class="language- extra-class"><pre class="language-text"><code>hash-id=6hf76tgk（如果为0，则为新建）
</code></pre></div><h3 id="post-xxx-remove"><a href="#post-xxx-remove" class="header-anchor">#</a> POST /xxx-remove</h3> <blockquote><p>删除列表中的一项或多项</p></blockquote> <p>请求参数：</p> <div class="language- extra-class"><pre class="language-text"><code>{
    &quot;Items&quot;:[&quot;i776jk&quot;,&quot;k67g3&quot;]    //仅hash id
}
</code></pre></div><h2 id="jwt内容"><a href="#jwt内容" class="header-anchor">#</a> JWT内容</h2> <div class="language- extra-class"><pre class="language-text"><code>Claims:{
    &quot;Expiry&quot;:&quot;2019-07-15T03:59:30Z&quot;    //遵循RFC3339且总是UTC时区
    &quot;HashId&quot;:&quot;a382jw&quot;    //用户的hash id
    &quot;Language&quot;:2    //用户的语言
}
</code></pre></div><h2 id="动态编辑框"><a href="#动态编辑框" class="header-anchor">#</a> 动态编辑框</h2> <p>动态编辑框用于[列表查询的xxx-edit/config修改]等场合，根据后端返回内容动态生成</p> <p>编辑框有以下`<code>type</code>，并且拥有<code>check</code>检查条件：</p> <table><thead><tr><th style="text-align:left;">type 种类</th> <th style="text-align:left;">check 检查条件</th></tr></thead> <tbody><tr><td style="text-align:left;">integer 整数</td> <td style="text-align:left;">范围区间检查，如：[1,4)U{6,7}，这是一个区间和集合的并集</td></tr> <tr><td style="text-align:left;">decimal 小数</td> <td style="text-align:left;">范围区间检查，如：(3.8,6]</td></tr> <tr><td style="text-align:left;">string （单行）字符串</td> <td style="text-align:left;">正则表达式检查</td></tr> <tr><td style="text-align:left;">text （多行）文本</td> <td style="text-align:left;">正则表达式检查</td></tr> <tr><td style="text-align:left;">array 下拉菜单</td> <td style="text-align:left;">可选内容数组，如：admin=管理员&amp;banned=被封禁用户</td></tr> <tr><td style="text-align:left;">bool 开关</td> <td style="text-align:left;">值只能为true或false</td></tr> <tr><td style="text-align:left;">date 日期</td> <td style="text-align:left;">范围区间检查，如：[2019/03/21,2020/01/01)</td></tr> <tr><td style="text-align:left;">time 时间</td> <td style="text-align:left;">范围区间检查，如：[2019/03/21 12:12:12,2020/01/01 12:12:12)</td></tr></tbody></table> <p><code>type</code>用于告知前端选择合适的编辑框，如：</p> <div class="language- extra-class"><pre class="language-text"><code>array种类通常用下拉菜单显示
bool种类则用开关控件显示
integer、decimal既可以使用普通文字编辑框控件，也可以使用数字控件
date既可以使用普通文字编辑控件，也可以使用日历控件
</code></pre></div><p><code>check</code>用于对编辑框输入值的检查，并不强制要求全部实现，甚至最简单粗暴的做法就是：全部使用普通文字编辑框，然后把<code>检查</code>以文字注释的方式标在旁边</p> <p>使用场景：</p> <div class="language- extra-class"><pre class="language-text"><code>通过GET /user/admin/user-edit?hashId=23y66b
可能收到返回：{
    &quot;Edits&quot;:[
        {
            &quot;Name&quot;:&quot;email&quot;,
            &quot;Text&quot;:&quot;邮箱&quot;,
            &quot;Type&quot;:&quot;string&quot;,    //显示普通的文字编辑框
            &quot;Check&quot;:&quot;[^@]+@[^\.]+\..+&quot;,    //一个简易的email检查
            &quot;Value&quot;:&quot;xxx@yy.com&quot;    //这个文字编辑框的当前值
        },
        {
            &quot;Name&quot;:&quot;role&quot;,
            &quot;Text&quot;:&quot;角色&quot;,
            &quot;Type&quot;:&quot;array&quot;,
            &quot;Check&quot;:&quot;admin=管理员&amp;banned=被封禁用户&amp;common=普通用户&quot;,
            //前端显示一个下拉菜单，文字分别是“管理员”、“被封禁用户”、“普通用户”
            &quot;Value&quot;:&quot;common&quot;,    //这个用户是一个普通用户，所以默认选择common
        },
        ...    //其他编辑项
    ]
}

通过POST /user/admin/user-update
对值进行更新：{
    &quot;HashId&quot;:&quot;23y66b&quot;,
    &quot;Updates&quot;:[
        {
            &quot;name&quot;:&quot;role&quot;,
            &quot;value&quot;:&quot;admin&quot;
        }
    ]
}
</code></pre></div><p>/admin/config-edit也使用此类返回</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/SkimBook/assets/js/app.39a981f5.js" defer></script><script src="/SkimBook/assets/js/2.67bc7483.js" defer></script><script src="/SkimBook/assets/js/14.ab42a9fe.js" defer></script>
  </body>
</html>
